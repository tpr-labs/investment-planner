<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Investment Planner</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons (as simple SVG components) -->
    <script type="text/babel">
        // Icon Components
        const IconWrapper = ({ children, className }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Wallet = (props) => <IconWrapper {...props}><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" /><path d="M4 6v12c0 1.1.9 2 2 2h14v-4" /><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h2v-4Z" /></IconWrapper>;
        const AlertCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></IconWrapper>;
        const Plus = (props) => <IconWrapper {...props}><path d="M5 12h14" /><path d="M12 5v14" /></IconWrapper>;
        const Trash2 = (props) => <IconWrapper {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6" /><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></IconWrapper>;
        const Pencil = (props) => <IconWrapper {...props}><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></IconWrapper>;
        const RotateCcw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></IconWrapper>;
        const Save = (props) => <IconWrapper {...props}><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" /><path d="M17 21v-8H7v8" /><path d="M7 3v5h8V3" /></IconWrapper>;
        const Calculator = (props) => <IconWrapper {...props}><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconWrapper>;
        const Search = (props) => <IconWrapper {...props}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></IconWrapper>;
        const AlertTriangle = (props) => <IconWrapper {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></IconWrapper>;
        const PieIcon = (props) => <IconWrapper {...props}><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></IconWrapper>;

        // App Logic
        const DEFAULT_PORTFOLIO = [
            { id: '1', name: 'HDFC Bank', symbol: 'HDFCBANK', price: 1740.00, allocation: 12, color: '#1d4ed8' }, 
            { id: '2', name: 'Reliance Industries', symbol: 'RELIANCE', price: 1260.00, allocation: 12, color: '#15803d' }, 
            { id: '3', name: 'Bajaj Finance', symbol: 'BAJFINANCE', price: 6550.00, allocation: 8, color: '#b45309' }, 
            { id: '4', name: 'Larsen & Toubro', symbol: 'LT', price: 3550.00, allocation: 10, color: '#374151' }, 
            { id: '5', name: 'TCS', symbol: 'TCS', price: 3950.00, allocation: 10, color: '#0e7490' }, 
            { id: '6', name: 'Infosys', symbol: 'INFY', price: 1550.00, allocation: 8, color: '#4f46e5' }, 
            { id: '7', name: 'Hindustan Unilever', symbol: 'HINDUNILVR', price: 2450.00, allocation: 8, color: '#be185d' }, 
            { id: '8', name: 'ITC', symbol: 'ITC', price: 435.00, allocation: 7, color: '#b91c1c' }, 
            { id: '9', name: 'Asian Paints', symbol: 'ASIANPAINT', price: 2850.00, allocation: 8, color: '#7c3aed' }, 
            { id: '10', name: 'Avenue Supermarts', symbol: 'DMART', price: 4100.00, allocation: 7, color: '#059669' } 
        ];

        const SimplePieChart = ({ data }) => {
            const [hoveredIndex, setHoveredIndex] = React.useState(null);
            
            const activeData = data.filter(d => d.allocation > 0);
            const total = activeData.reduce((acc, cur) => acc + cur.allocation, 0);

            if (activeData.length === 0) {
                return (
                    <div className="flex flex-col items-center justify-center h-64 bg-slate-50 rounded-xl border border-dashed border-slate-300">
                        <PieIcon className="w-10 h-10 text-slate-300 mb-2" />
                        <p className="text-slate-400 text-sm">Add allocations to see chart</p>
                    </div>
                );
            }

            let cumulativePercent = 0;

            const getCoordinatesForPercent = (percent) => {
                const x = Math.cos(2 * Math.PI * percent);
                const y = Math.sin(2 * Math.PI * percent);
                return [x, y];
            };

            const slices = activeData.map((slice, index) => {
                const startPercent = cumulativePercent;
                const slicePercent = slice.allocation / (total || 1);
                cumulativePercent += slicePercent;
                const endPercent = cumulativePercent;

                const [startX, startY] = getCoordinatesForPercent(startPercent);
                const [endX, endY] = getCoordinatesForPercent(endPercent);
                const largeArcFlag = slicePercent > 0.5 ? 1 : 0;

                const pathData = [
                    `M 0 0`,
                    `L ${startX} ${startY}`,
                    `A 1 1 0 ${largeArcFlag} 1 ${endX} ${endY}`,
                    `L 0 0`,
                ].join(' ');

                return { pathData, color: slice.color || '#cbd5e1', ...slice, index };
            });

            return (
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 className="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                        <PieIcon className="w-5 h-5 text-indigo-600" /> Portfolio Distribution
                    </h3>
                    
                    <div className="flex flex-col md:flex-row items-center gap-8">
                        <div className="relative w-48 h-48 md:w-56 md:h-56 flex-shrink-0">
                            <svg viewBox="-1.1 -1.1 2.2 2.2" className="w-full h-full transform -rotate-90">
                                {slices.map((slice) => (
                                    <path
                                        key={slice.id}
                                        d={slice.pathData}
                                        fill={slice.color}
                                        stroke="white"
                                        strokeWidth="0.02"
                                        className="transition-all duration-300 hover:opacity-90 cursor-pointer"
                                        onMouseEnter={() => setHoveredIndex(slice.index)}
                                        onMouseLeave={() => setHoveredIndex(null)}
                                        style={{ 
                                            transform: hoveredIndex === slice.index ? 'scale(1.05)' : 'scale(1)',
                                            transformOrigin: '0 0'
                                        }}
                                    />
                                ))}
                            </svg>
                            <div className="absolute inset-0 m-auto w-24 h-24 md:w-28 md:h-28 bg-white rounded-full flex items-center justify-center flex-col shadow-inner">
                                <span className="text-2xl font-bold text-slate-700">{total}%</span>
                                <span className="text-[10px] text-slate-400 uppercase tracking-wider">Allocated</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-x-6 gap-y-2 w-full text-sm">
                            {activeData.map((item, idx) => (
                                <div 
                                    key={item.id} 
                                    className={`flex items-center justify-between p-1.5 rounded transition-colors ${hoveredIndex === idx ? 'bg-slate-50' : ''}`}
                                    onMouseEnter={() => setHoveredIndex(idx)}
                                    onMouseLeave={() => setHoveredIndex(null)}
                                >
                                    <div className="flex items-center gap-2 overflow-hidden">
                                        <span className="w-3 h-3 rounded-full flex-shrink-0" style={{ backgroundColor: item.color || '#cbd5e1' }}></span>
                                        <span className="truncate text-slate-600 font-medium" title={item.name}>{item.name}</span>
                                    </div>
                                    <span className="font-bold text-slate-800 ml-2">{item.allocation}%</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const StockCard = ({ stock, totalAmount, onUpdate, onDelete, onEdit }) => {
            const allocatedValue = (totalAmount * stock.allocation) / 100;
            const quantity = stock.price > 0 ? Math.floor(allocatedValue / stock.price) : 0;
            const actualInvested = quantity * stock.price;
            const leftover = allocatedValue - actualInvested;
            
            return (
                <div className={`bg-white rounded-xl shadow-sm border p-4 transition-all hover:shadow-md relative group ${stock.allocation > 0 ? 'border-indigo-100 ring-1 ring-indigo-50' : 'border-slate-200'}`}>
                    
                    <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center gap-3 overflow-hidden">
                            <div 
                                className="w-10 h-10 rounded-lg flex-shrink-0 flex items-center justify-center font-bold text-[10px] md:text-xs text-center leading-tight p-1 text-white shadow-sm"
                                style={{ backgroundColor: stock.color || '#94a3b8' }}
                            >
                                {stock.symbol || stock.name.substring(0, 3).toUpperCase()}
                            </div>
                            <div className="min-w-0">
                                <h3 className="font-bold text-slate-800 leading-tight truncate pr-2">{stock.name}</h3>
                                <div className="flex items-center gap-2 text-xs text-slate-500">
                                    <span className="font-mono bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100">₹{stock.price.toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex gap-1 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity focus-within:opacity-100">
                            <button 
                                onClick={() => onEdit(stock)}
                                className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
                            >
                                <Pencil className="w-4 h-4" />
                            </button>
                            <button 
                                onClick={() => onDelete(stock.id)}
                                className="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                            >
                                <Trash2 className="w-4 h-4" />
                            </button>
                        </div>
                    </div>

                    <div className="space-y-3 mb-4">
                        <div className="flex justify-between items-center mb-1.5">
                            <label className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Allocation</label>
                            <span className={`text-sm font-bold px-2 py-0.5 rounded ${stock.allocation > 0 ? 'text-indigo-600 bg-indigo-50' : 'text-slate-400 bg-slate-100'}`}>
                                {stock.allocation}%
                            </span>
                        </div>
                        <input
                            type="range"
                            min="0"
                            max="100"
                            value={stock.allocation}
                            onChange={(e) => onUpdate(stock.id, { ...stock, allocation: Number(e.target.value) })}
                            className={`w-full h-2 rounded-lg appearance-none cursor-pointer ${stock.allocation > 0 ? 'bg-indigo-100 accent-indigo-600' : 'bg-slate-100 accent-slate-400'}`}
                        />
                    </div>

                    <div className="bg-slate-50 rounded-lg p-3 grid grid-cols-2 gap-y-3 gap-x-4 border border-slate-100">
                        <div className="border-r border-slate-200 pr-2">
                            <p className="text-[10px] text-slate-400 uppercase tracking-wider mb-0.5">Target Allocation</p>
                            <p className="font-semibold text-indigo-600 text-sm">₹{allocatedValue.toLocaleString('en-IN', { maximumFractionDigits: 0 })}</p>
                        </div>
                        <div className="text-right pl-2">
                            <p className="text-[10px] text-slate-400 uppercase tracking-wider mb-0.5">Buy Quantity</p>
                            <p className={`font-bold text-lg leading-none ${stock.allocation > 0 ? 'text-indigo-600' : 'text-slate-300'}`}>
                                {quantity} <span className="text-[10px] font-normal text-slate-400">Qty</span>
                            </p>
                        </div>
                        <div className="col-span-2 border-t border-slate-200"></div>
                        <div>
                            <p className="text-[10px] text-slate-400 uppercase tracking-wider mb-0.5">Actually Invested</p>
                            <p className="font-medium text-slate-700 text-xs">₹{actualInvested.toLocaleString('en-IN')}</p>
                        </div>
                        <div className="text-right">
                            <p className="text-[10px] text-slate-400 uppercase tracking-wider mb-0.5">Remaining</p>
                            <p className="font-mono text-xs font-medium text-slate-500">₹{leftover.toFixed(0)}</p>
                        </div>
                    </div>
                </div>
            );
        };

        const StockModal = ({ isOpen, onClose, onSave, initialData }) => {
            const [formData, setFormData] = React.useState({ name: '', symbol: '', price: '', allocation: 0, color: '#6366f1' });

            React.useEffect(() => {
                if (isOpen) {
                    if (initialData) {
                        setFormData({ ...initialData, color: initialData.color || '#6366f1' });
                    } else {
                        setFormData({ name: '', symbol: '', price: '', allocation: 0, color: '#' + Math.floor(Math.random()*16777215).toString(16) });
                    }
                }
            }, [isOpen, initialData]);

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    ...formData,
                    price: Number(formData.price),
                    allocation: Number(formData.allocation)
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 z-50 flex items-end md:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in">
                    <div className="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl animate-slide-up">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                {initialData ? <Pencil className="w-5 h-5 text-indigo-600" /> : <Plus className="w-5 h-5 text-indigo-600" />}
                                {initialData ? 'Edit Details' : 'Add Stock'}
                            </h2>
                            <button onClick={onClose} className="p-2 bg-slate-100 rounded-full hover:bg-slate-200">
                                <X className="w-5 h-5 text-slate-600" />
                            </button>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="space-y-5">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Stock Name</label>
                                <input 
                                    required
                                    type="text" 
                                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none"
                                    value={formData.name}
                                    onChange={e => setFormData({...formData, name: e.target.value})}
                                />
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Symbol</label>
                                    <input 
                                        type="text" 
                                        className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none uppercase font-mono text-sm"
                                        value={formData.symbol}
                                        onChange={e => setFormData({...formData, symbol: e.target.value})}
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Price (₹)</label>
                                    <input 
                                        required
                                        type="number" 
                                        step="0.01"
                                        className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none"
                                        value={formData.price}
                                        onChange={e => setFormData({...formData, price: e.target.value})}
                                    />
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Allocation (%)</label>
                                <div className="relative">
                                    <input 
                                        required
                                        type="number" 
                                        min="0"
                                        max="100"
                                        className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none pr-12"
                                        value={formData.allocation}
                                        onChange={e => setFormData({...formData, allocation: e.target.value})}
                                    />
                                    <span className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">%</span>
                                </div>
                            </div>

                            <button 
                                type="submit"
                                className="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl mt-2 hover:bg-indigo-700 active:scale-95 transition-all flex items-center justify-center gap-2"
                            >
                                <Save className="w-5 h-5" />
                                Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [totalAmount, setTotalAmount] = React.useState(25000);
            const [stocks, setStocks] = React.useState(DEFAULT_PORTFOLIO);
            const [isModalOpen, setIsModalOpen] = React.useState(false);
            const [editingStock, setEditingStock] = React.useState(null);
            const [searchTerm, setSearchTerm] = React.useState('');
            const [showError, setShowError] = React.useState(false);

            const summary = React.useMemo(() => {
                let totalAllocatedPercent = 0;
                let totalInvested = 0;

                stocks.forEach(stock => {
                    totalAllocatedPercent += stock.allocation;
                    const allocatedVal = (totalAmount * stock.allocation) / 100;
                    const qty = stock.price > 0 ? Math.floor(allocatedVal / stock.price) : 0;
                    totalInvested += qty * stock.price;
                });

                return { totalAllocatedPercent, totalInvested };
            }, [totalAmount, stocks]);

            const remainingCash = totalAmount - summary.totalInvested;
            const isOverAllocated = summary.totalAllocatedPercent > 100;

            const filteredStocks = stocks.filter(s => 
                s.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                s.symbol.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const handleSaveStock = (stockData) => {
                if (editingStock) {
                    setStocks(stocks.map(s => s.id === editingStock.id ? { ...stockData, id: s.id } : s));
                } else {
                    setStocks([...stocks, { ...stockData, id: Date.now().toString() }]);
                }
                setEditingStock(null);
            };

            const handleEditClick = (stock) => {
                setEditingStock(stock);
                setIsModalOpen(true);
            };

            const handleAddClick = () => {
                if (summary.totalAllocatedPercent >= 100) {
                    setShowError(true);
                    setTimeout(() => setShowError(false), 4000);
                    return;
                }
                setEditingStock(null);
                setIsModalOpen(true);
            };

            const handleUpdateStock = (id, updatedStock) => {
                setStocks(stocks.map(s => s.id === id ? updatedStock : s));
            };

            const handleDeleteStock = (id) => {
                if(window.confirm('Remove this stock from your list?')) {
                    setStocks(stocks.filter(s => s.id !== id));
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans pb-44 md:pb-36">
                    {showError && (
                        <div className="fixed top-4 left-4 right-4 z-50 animate-fade-in flex justify-center">
                            <div className="bg-red-600 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 max-w-md w-full">
                                <AlertTriangle className="w-6 h-6 flex-shrink-0" />
                                <div>
                                    <p className="font-bold">Allocation Full</p>
                                    <p className="text-sm opacity-90">No available percentage. Please reduce other stocks to less than 100% before adding new ones.</p>
                                </div>
                                <button onClick={() => setShowError(false)} className="ml-auto p-1 hover:bg-red-700 rounded">
                                    <X className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
                        <div className="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="bg-indigo-600 p-2 rounded-lg">
                                    <Calculator className="text-white w-5 h-5" />
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold text-slate-800 leading-none">Monthly<span className="text-indigo-600">Invest</span></h1>
                                    <p className="text-[10px] text-slate-500 font-medium">Smart Allocation Planner</p>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => { if(window.confirm("Reset all stocks to default list?")) setStocks(DEFAULT_PORTFOLIO); }}
                                    className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors"
                                    title="Reset Defaults"
                                >
                                    <RotateCcw className="w-5 h-5" />
                                </button>
                                <button 
                                    onClick={handleAddClick}
                                    className={`p-2 rounded-lg transition-colors flex items-center gap-1 font-semibold ${summary.totalAllocatedPercent >= 100 ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-indigo-50 text-indigo-600 hover:bg-indigo-100'}`}
                                >
                                    <Plus className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    </div>

                    <main className="max-w-5xl mx-auto px-4 py-6 space-y-8">
                        <section className="bg-slate-900 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-40 h-40 bg-indigo-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10"></div>
                            
                            <div className="flex flex-col gap-2 relative z-10">
                                <label className="text-indigo-200 text-xs font-bold uppercase tracking-widest flex items-center gap-2">
                                    <Wallet className="w-4 h-4" /> Monthly Capital
                                </label>
                                <div className="relative">
                                    <span className="absolute left-0 top-1/2 -translate-y-1/2 text-slate-500 text-3xl font-light">₹</span>
                                    <input
                                        type="number"
                                        value={totalAmount}
                                        onChange={(e) => setTotalAmount(Math.max(0, parseFloat(e.target.value) || 0))}
                                        className="w-full bg-transparent border-none text-5xl font-bold p-0 pl-8 focus:ring-0 placeholder-slate-700"
                                        placeholder="0"
                                    />
                                </div>
                            </div>
                        </section>

                        <div className="relative">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                            <input 
                                type="text" 
                                placeholder="Search stocks..." 
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-100 outline-none shadow-sm"
                            />
                        </div>

                        {isOverAllocated && (
                            <div className="bg-red-50 border border-red-200 p-4 rounded-xl flex items-start gap-3 animate-pulse">
                                <AlertCircle className="w-5 h-5 text-red-600 mt-0.5" />
                                <div className="text-sm">
                                    <span className="font-bold text-red-800">Allocation Error ({summary.totalAllocatedPercent}%)</span>
                                    <p className="text-red-700">Please reduce allocation by <strong>{summary.totalAllocatedPercent - 100}%</strong>.</p>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {filteredStocks.map(stock => (
                                <StockCard 
                                    key={stock.id} 
                                    stock={stock} 
                                    totalAmount={totalAmount}
                                    onUpdate={handleUpdateStock}
                                    onDelete={handleDeleteStock}
                                    onEdit={handleEditClick}
                                />
                            ))}
                            
                            {filteredStocks.length === 0 && (
                                <div className="col-span-full text-center py-12 text-slate-400">
                                    <p>No stocks found matching "{searchTerm}"</p>
                                </div>
                            )}
                        </div>

                        <SimplePieChart data={stocks} />

                    </main>

                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-20 pb-safe">
                        <div className="max-w-5xl mx-auto px-4 py-3">
                            <div className="flex flex-col gap-3">
                                <div className="flex items-center gap-3">
                                    <div className="flex-1 h-2.5 bg-slate-100 rounded-full overflow-hidden">
                                        <div 
                                            className={`h-full transition-all duration-500 ${isOverAllocated ? 'bg-red-500' : 'bg-indigo-600'}`}
                                            style={{ width: `${Math.min(summary.totalAllocatedPercent, 100)}%` }}
                                        />
                                    </div>
                                    <span className={`text-xs font-bold w-12 text-right ${isOverAllocated ? 'text-red-500' : 'text-slate-500'}`}>
                                        {summary.totalAllocatedPercent}%
                                    </span>
                                </div>

                                <div className="flex justify-between items-end">
                                    <div>
                                        <p className="text-[10px] text-slate-400 uppercase tracking-wider mb-0.5">Total Invested</p>
                                        <p className="text-lg font-bold text-slate-800">₹{summary.totalInvested.toLocaleString('en-IN')}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-[10px] text-slate-400 uppercase tracking-wider mb-0.5">Unused Cash</p>
                                        <p className={`text-lg font-bold ${remainingCash < 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                                            ₹{remainingCash.toLocaleString('en-IN')}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <StockModal 
                        isOpen={isModalOpen} 
                        onClose={() => setIsModalOpen(false)} 
                        onSave={handleSaveStock}
                        initialData={editingStock}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <style>
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.2s ease-out; }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>
</body>
</html>
